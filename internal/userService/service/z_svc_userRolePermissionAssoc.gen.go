// Code generated by tools/genCURD. DO NOT EDIT.

package service

import "time"

import (
	"context"

	"github.com/pancake-lee/pgo/api"
	"github.com/pancake-lee/pgo/internal/userService/data"
	"github.com/pancake-lee/pgo/pkg/plogger"
)

func DO2DTO_UserRolePermissionAssoc(do *data.UserRolePermissionAssocDO) *api.UserRolePermissionAssocInfo {
	if do == nil {
		return nil
	}
	return &api.UserRolePermissionAssocInfo{
        ID: do.ID,
        CreateTime: do.CreateTime.Unix(),
        CreateUser: do.CreateUser,
        RoleID: do.RoleID,
        Action: do.Action,
        PathPattern: do.PathPattern,
	}
}
func DTO2DO_UserRolePermissionAssoc(dto *api.UserRolePermissionAssocInfo) *data.UserRolePermissionAssocDO {
	if dto == nil {
		return nil
	}
	return &data.UserRolePermissionAssocDO{
        ID: dto.ID,
        CreateTime: time.Unix(dto.CreateTime, 0),
        CreateUser: dto.CreateUser,
        RoleID: dto.RoleID,
        Action: dto.Action,
        PathPattern: dto.PathPattern,
	}
}

func (s *UserCURDServer) AddUserRolePermissionAssoc(
	ctx context.Context, req *api.AddUserRolePermissionAssocRequest,
) (resp *api.AddUserRolePermissionAssocResponse, err error) {
	if req.UserRolePermissionAssoc == nil {
		return nil, api.ErrorInvalidArgument("")
	}
	newData := DTO2DO_UserRolePermissionAssoc(req.UserRolePermissionAssoc)

	err = data.UserRolePermissionAssocDAO.Add(ctx, newData)
	if err != nil {
		return nil, plogger.LogErr(err)
	}

	plogger.Debugf("AddUserRolePermissionAssoc: %v", newData.ID)

	resp = new(api.AddUserRolePermissionAssocResponse)
	resp.UserRolePermissionAssoc = DO2DTO_UserRolePermissionAssoc(newData)
	return resp, nil
}

func (s *UserCURDServer) GetUserRolePermissionAssocList(
	ctx context.Context, req *api.GetUserRolePermissionAssocListRequest,
) (resp *api.GetUserRolePermissionAssocListResponse, err error) {

	var dataList []*data.UserRolePermissionAssocDO

	if len(req.IDList) != 0 {
		plogger.Debugf("GetUserRolePermissionAssocList: %v", req.IDList)

		dataMap, err := data.UserRolePermissionAssocDAO.GetByIDList(ctx, req.IDList)
		if err != nil {
			return nil, plogger.LogErr(err)
		}
		for _, d := range dataMap {
			dataList = append(dataList, d)
		}
	} else {

		dataList, err = data.UserRolePermissionAssocDAO.GetAll(ctx)
		if err != nil {
			return nil, plogger.LogErr(err)
		}

	}

	plogger.Debugf("GetUserRolePermissionAssocList resp len %v", len(dataList))

	resp = new(api.GetUserRolePermissionAssocListResponse)
	resp.UserRolePermissionAssocList = make([]*api.UserRolePermissionAssocInfo, 0, len(dataList))
	for _, data := range dataList {
		resp.UserRolePermissionAssocList = append(resp.UserRolePermissionAssocList, DO2DTO_UserRolePermissionAssoc(data))
	}
	return resp, nil
}


func (s *UserCURDServer) UpdateUserRolePermissionAssoc(
	ctx context.Context, req *api.UpdateUserRolePermissionAssocRequest,
) (resp *api.UpdateUserRolePermissionAssocResponse, err error) {
	if req.UserRolePermissionAssoc == nil {
		return nil, api.ErrorInvalidArgument("")
	}

	do := DTO2DO_UserRolePermissionAssoc(req.UserRolePermissionAssoc)
	err = data.UserRolePermissionAssocDAO.UpdateByID(ctx, do)
	if err != nil {
		return nil, plogger.LogErr(err)
	}
	plogger.Debugf("UpdateUserRolePermissionAssoc %v", req.UserRolePermissionAssoc.ID)

	resp = new(api.UpdateUserRolePermissionAssocResponse)
	d, err := data.UserRolePermissionAssocDAO.GetByID(ctx, req.UserRolePermissionAssoc.ID)
	if err != nil {
		return nil, plogger.LogErr(err)
	}
	resp.UserRolePermissionAssoc = DO2DTO_UserRolePermissionAssoc(d)
	return resp, nil
}

func (s *UserCURDServer) DelUserRolePermissionAssocByIDList(
	ctx context.Context, req *api.DelUserRolePermissionAssocByIDListRequest,
) (resp *api.Empty, err error) {
	if len(req.IDList) == 0 {
		return nil, nil
	}
	err = data.UserRolePermissionAssocDAO.DelByIDList(ctx, req.IDList)
	if err != nil {
		return nil, plogger.LogErr(err)
	}
	plogger.Debugf("DelUserRolePermissionAssocByIDList %v", req.IDList)
	return nil, nil
}

