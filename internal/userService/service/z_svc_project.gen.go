// Code generated by tools/genCURD. DO NOT EDIT.

package service

import "time"

import (
	"context"

	"github.com/pancake-lee/pgo/api"
	"github.com/pancake-lee/pgo/internal/userService/data"
	"github.com/pancake-lee/pgo/pkg/papp"
)

func DO2DTO_Project(do *data.ProjectDO) *api.ProjectInfo {
	if do == nil {
		return nil
	}
	return &api.ProjectInfo{
        ID: do.ID,
        CreateTime: do.CreateTime.Unix(),
        CreateUser: do.CreateUser,
        UpdateTime: do.UpdateTime.Unix(),
        UpdateUser: do.UpdateUser,
        ProjName: do.ProjName,
        MtblRecordID: do.MtblRecordID,
        LastEditFrom: do.LastEditFrom,
	}
}
func DTO2DO_Project(dto *api.ProjectInfo) *data.ProjectDO {
	if dto == nil {
		return nil
	}
	return &data.ProjectDO{
        ID: dto.ID,
        CreateTime: time.Unix(dto.CreateTime, 0),
        CreateUser: dto.CreateUser,
        UpdateTime: time.Unix(dto.UpdateTime, 0),
        UpdateUser: dto.UpdateUser,
        ProjName: dto.ProjName,
        MtblRecordID: dto.MtblRecordID,
        LastEditFrom: dto.LastEditFrom,
	}
}

func (s *UserCURDServer) AddProject(
	_ctx context.Context, req *api.AddProjectRequest,
) (resp *api.AddProjectResponse, err error) {
	ctx := papp.NewAppCtx(_ctx)

	if req.Project == nil {
		return nil, api.ErrorInvalidArgument("")
	}
	newData := DTO2DO_Project(req.Project)

	err = data.ProjectDAO.Add(ctx, newData)
	if err != nil {
		return nil, ctx.Log.LogErr(err)
	}

	ctx.Log.Debugf("AddProject: %v", newData.ID)

	resp = new(api.AddProjectResponse)
	resp.Project = DO2DTO_Project(newData)
	return resp, nil
}

func (s *UserCURDServer) GetProjectList(
	_ctx context.Context, req *api.GetProjectListRequest,
) (resp *api.GetProjectListResponse, err error) {
	ctx := papp.NewAppCtx(_ctx)

	var dataList []*data.ProjectDO

	if len(req.IDList) != 0 {
		ctx.Log.Debugf("GetProjectList: %v", req.IDList)

		dataList, err = data.ProjectDAO.GetByIndex(ctx,
            req.IDList,
		)
		if err != nil {
			return nil, ctx.Log.LogErr(err)
		}
	} else {

		dataList, err = data.ProjectDAO.GetAll(ctx)
		if err != nil {
			return nil, ctx.Log.LogErr(err)
		}

	}

	ctx.Log.Debugf("GetProjectList resp len %v", len(dataList))

	resp = new(api.GetProjectListResponse)
	resp.ProjectList = make([]*api.ProjectInfo, 0, len(dataList))
	for _, data := range dataList {
		resp.ProjectList = append(resp.ProjectList, DO2DTO_Project(data))
	}
	return resp, nil
}


func (s *UserCURDServer) UpdateProject(
	_ctx context.Context, req *api.UpdateProjectRequest,
) (resp *api.UpdateProjectResponse, err error) {
	ctx := papp.NewAppCtx(_ctx)

	if req.Project == nil {
		return nil, api.ErrorInvalidArgument("")
	}

	do := DTO2DO_Project(req.Project)
	err = data.ProjectDAO.UpdateByID(ctx, do)
	if err != nil {
		return nil, ctx.Log.LogErr(err)
	}
	ctx.Log.Debugf("UpdateProject %v", req.Project.ID)

	resp = new(api.UpdateProjectResponse)
	d, err := data.ProjectDAO.GetByID(ctx, req.Project.ID)
	if err != nil {
		return nil, ctx.Log.LogErr(err)
	}
	resp.Project = DO2DTO_Project(d)
	return resp, nil
}

func (s *UserCURDServer) DelProjectByIDList(
	_ctx context.Context, req *api.DelProjectByIDListRequest,
) (resp *api.Empty, err error) {
	ctx := papp.NewAppCtx(_ctx)

	if len(req.IDList) == 0 {
		return nil, nil
	}
	err = data.ProjectDAO.DelByIDList(ctx, req.IDList)
	if err != nil {
		return nil, ctx.Log.LogErr(err)
	}
	ctx.Log.Debugf("DelProjectByIDList %v", req.IDList)
	return nil, nil
}

